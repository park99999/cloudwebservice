<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
        .button-group {
            margin: 10px 0;
            text-align: center;
        }
        .button-group button {
            margin: 5px;
            padding: 3px 5px;
            font-size: 14px;
            cursor: pointer;
        }
        #searchResult {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="button-group">
        <button id="busStopBtn">버스 정류소 위치 조회</button>
        <button id="evStationBtn">전기차 충전소 위치 조회</button>
        <button id="bikeRentalBtn">자전거 대여소 위치 조회</button>
        <button id="myReviewBtn">내가 쓴 리뷰 조회</button>
    </div>
    <!-- 지도 표시 -->
    <div id="map"></div>

    <!-- 버튼 그룹 -->
    

    <!-- 조회 결과 -->
    <div id="searchResult">
        <h3>조회 결과</h3>
        <ul id="resultList"></ul>
    </div>

    <!-- 카카오 지도 API -->
    <script 
        type="text/javascript" 
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0aace081d030d026f82d5e78011f64c5&libraries=services"></script>
    
    <script>
        // 지도 생성
        let map;
        function initializeMap(latitude, longitude) {
            var mapContainer = document.getElementById('map'); // 지도를 표시할 div
            var mapOption = {
                center: new kakao.maps.LatLng(latitude, longitude), // 초기 위치
                level: 4 // 확대 레벨
            };

            // 지도 객체 생성
            map = new kakao.maps.Map(mapContainer, mapOption);
        }

        // 사용자 위치 가져오기
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        initializeMap(latitude, longitude);
                    },
                    (error) => {
                        console.error('위치 정보를 가져올 수 없습니다.', error);
                        // 기본 위치 설정 (예: 서울 중심)
                        initializeMap(37.5665, 126.9780);
                    }
                );
            } else {
                console.error('브라우저가 위치 정보를 지원하지 않습니다.');
                // 기본 위치 설정 (예: 서울 중심)
                initializeMap(37.5665, 126.9780);
            }
        }

        // AWS Lambda 함수 호출
        async function fetchLocations(type) {
            try {
                const response = await fetch(`https://YOUR_API_GATEWAY_ENDPOINT/${type}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) throw new Error('조회 실패');
                const data = await response.json();

                // 결과 표시
                displayResults(data);
            } catch (error) {
                console.error('오류 발생:', error);
                alert('위치 정보를 가져오는 데 실패했습니다.');
            }
        }

        // 조회 결과 표시
        function displayResults(locations) {
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = ''; // 기존 결과 초기화

            if (locations.length === 0) {
                resultList.innerHTML = '<li>결과가 없습니다.</li>';
                return;
            }

            locations.forEach((location) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${location.name} - ${location.address}`;
                resultList.appendChild(listItem);

                // 지도에 마커 추가
                const markerPosition = new kakao.maps.LatLng(location.latitude, location.longitude);
                const marker = new kakao.maps.Marker({
                    position: markerPosition,
                    map: map
                });

                // 마커에 정보 창 추가
                const infoWindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">${location.name}</div>`
                });

                kakao.maps.event.addListener(marker, 'click', () => {
                    infoWindow.open(map, marker);
                });
            });
        }

        // 버튼 이벤트 리스너 추가
        document.getElementById('busStopBtn').addEventListener('click', () => fetchLocations('busStops'));
        document.getElementById('evStationBtn').addEventListener('click', () => fetchLocations('evStations'));
        document.getElementById('bikeRentalBtn').addEventListener('click', () => fetchLocations('bikeRentals'));
        document.getElementById('myReviewBtn').addEventListener('click', () => {
            window.location.href = '/myreview.html';
        });

        // 초기화
        getCurrentLocation();
    </script>
</body>
</html>
